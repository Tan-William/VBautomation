<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>


<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-au">
<title>Microsoft Access tips: Subquery basics</title>
<meta name="description" content="Using subqueries in Microsoft Access. What subqueries are, and examples of using subqueries.">
<meta name="keywords" content="subquery,Microsoft Access,query">
<meta name="Author" content="Allen Browne">
<meta name="copyright" content="© 2006 Allen Browne">
<!-- base -->
<link rel="stylesheet" type="text/css" href="subquery%20examples_files/abdt.css">
</head><body>

<h3><a name="Top">Microsoft Access Tips for Serious Users</a></h3>
<p>Provided by <a href="mailto:allen@allenbrowne.com">Allen Browne</a>, March 2007. Updated February 2009.</p>
<hr>
<div style="border: 1px solid rgb(204, 204, 204); margin: 10px 0px 25px 25px; padding: 25px; background-color: rgb(51, 102, 204); float: right;">
<h5 style="margin-top: 0pt; margin-bottom: 0pt;">Contents - subquery examples:</h5>
<p class="TocBox"><a href="#NotThere" class="TipNavAnchor">Identifying what is NOT there</a></p>
<p class="TocBox"><a href="#AnotherRecord" class="TipNavAnchor">Get the value in another record</a></p>
<p class="TocBox"><a href="#TopN" class="TipNavAnchor">TOP n records per group</a></p>
<p class="TocBox"><a href="#YTD" class="TipNavAnchor">Year-to-date</a></p>
<p class="TocBox"><a href="#DeleteUnmatched" class="TipNavAnchor">Delete unmatched records</a>&nbsp;</p>
<p class="TocBox"><a href="#DeDuplicate" class="TipNavAnchor">Delete duplicate records</a>&nbsp;</p>
<p class="TocBox"><a href="#Aggregation" class="TipNavAnchor">Aggregation: counts, totals</a></p>
<p class="TocBox"><a href="#Search" class="TipNavAnchor">Filters and searches</a></p>
<p class="TocBox"><a href="#Other" class="TipNavAnchor">Other examples</a></p>
</div>
<h1>Subquery basics</h1>
<p>Discovering subqueries is one of those "Eureka!" moments. A new
landscape opens in front of you, and you can do really useful things
such as:</p>
<ul>
	<li><p class="HalfSpaced">Read a value from the <b>previous</b> or <b>next</b> record in a table.</p></li>
	<li><p class="HalfSpaced">Select just the <b>TOP</b> (or most recent) 5 scores <b>per client</b>.</p></li>
	<li><p class="HalfSpaced">Choose the people who have <b>not</b> paid/ordered/enrolled in a period.</p></li>
	<li><p class="HalfSpaced">Express a value as a percentage of the <b>total</b>.</p></li>
	<li><p class="HalfSpaced"><b>Avoid inflated totals</b> where a record is repeated (due to multiple related records.)</p></li>
	<li><p class="HalfSpaced">Filter or calculate values from <b>other tables</b> that are not even in the query.</p></li>
</ul>
<p>&nbsp;</p>
<h2>What is a subquery?</h2>
<div style="border: 1px solid rgb(0, 0, 128); padding: 10px; width: 285px; float: right; margin-left: 20px; margin-bottom: 20px; background-color: rgb(255, 255, 204);">
	<h3 style="margin-bottom: 0px;" align="center">The SELECT query statement</h3>
	<hr>
	<p style="margin-top: 5px; margin-bottom: 5px;"><font color="#0000cc">This example shows basic SQL syntax. <br>
	It returns 3 fields from 1 table, applies criteria, and sorts the results:</font></p>
	<p style="margin-left: 20px; margin-top: 0pt;"><b>SELECT</b> CompanyID, Company, City <br>
	<b>FROM</b> Table1 <br>
	<b>WHERE</b> (City = "Springfield") <br>
	<b>ORDER BY</b> Company;</p>
	<p><font color="#0000cc">The clauses must be in the right order. Line endings and brackets are optional.</font></p>
</div>
<p>A subquery is a SELECT query statement inside another query.</p>
<p>As you drag fields and type expressions in query design, Access
writes a sentence describing what you asked for. The statement is in <b>SQL</b> (<i>see'quell</i>)
- Structured Query Language - the most common relational database
language, also used by MySQL, SQL Server, Oracle, DB2, FoxPro, dBase,
and others.</p>
<p>If SQL is a foreign language, you can mock up a query like the
subquery you need, switch it to SQL View, copy, and paste into SQL View
in your main query. There will be some tidying up to do, but that's the
simplest way to create a subquery.</p>
<h1>Subquery examples</h1>
<p>The best way to grasp subqueries is to look at examples of how to use them.</p>
<h2><a name="NotThere"></a>Identifying what is NOT there</h2>
<p>A sales rep. wants to hound customers who have not placed any orders in the last 90 days:</p>
<div class="QuerySim">SELECT Customers.ID, Customers.Company <br>
FROM Customers <br>
WHERE NOT EXISTS <br>
	&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
(SELECT Orders.OrderID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">&nbsp;FROM
Orders&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">&nbsp;WHERE Orders.CustomerID = Customers.CustomerID&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">&nbsp;&nbsp; AND Orders.OrderDate &gt; Date() - 90)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; </span>;</div>
<p>The main query selects two fields (ID and Company) from the
Customers table. It is limited by the WHERE clause, which contains the
subquery.</p>
<p>The subquery (everything inside the brackets) selects <i>Order ID</i> from the <i>Orders</i> table, limited by two criteria: it has to be the same customer as the one being considered in the main query, and the <i>Order Date</i> has to be in the last 90 days.</p>
<p>When the main query runs, Access examines each record in the
Customers table. To decide whether to include the customer, it runs the
subquery. The subquery finds any orders for that customer in the
period. If it finds any, the customer is excluded by the NOT EXISTS.</p>
<h3>Points to note:</h3>
<ul>
	<li><p class="HalfSpaced">The <b>subquery</b> goes <b>in brackets</b>, without a semicolon of its own.</p></li>
	<li><p class="HalfSpaced">The <i>Orders</i> table is not even in the main query. Subqueries are ideal for querying about data in other tables.</p></li>
	<li><p class="HalfSpaced">The <b>subquery</b> does not have the <i>Customers</i> table in its FROM clause, yet it <b>can refer to values in the main query</b>.</p></li>
	<li><p class="HalfSpaced">Subqueries are useful for answering questions about what data exists or <b>does not exist in a related table</b>.</p></li>
</ul>
<p>&nbsp;</p>

<h2><a name="AnotherRecord"></a>Get the value in another record</h2>
<p>Periodically, they read the meter at your house, and send a bill for
the number of units used since the previous reading. The previous
reading is a different record in the same table. How can they query
that?</p>
<p>A subquery can read another record in the same table, like this:</p>
<div class="QuerySim">SELECT MeterReading.ID, <br>
MeterReading.ReadDate, <br>
MeterReading.MeterValue, <br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
(SELECT TOP 1
Dupe.MeterValue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
FROM MeterReading AS
Dupe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);"> WHERE Dupe.AddressID = MeterReading.AddressID&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">&nbsp;&nbsp; AND Dupe.ReadDate &lt; MeterReading.ReadDate&nbsp;&nbsp;&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);"> ORDER BY Dupe.ReadDate DESC, Dupe.ID)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;AS PriorValue <br>
FROM MeterReading;</div>
<p>The main query here contains 4 fields: the primary key, the reading
date, the meter value at that date, and a fourth field that is the
value returned from the subquery.</p>
<p>The subquery returns just one meter reading (TOP 1.) The WHERE
clause limits it to the same address, and a previous date. The ORDER BY
clause sorts by descending date, so the most recent record will be the
first one.</p>
<h3>Points to note:</h3>
<ul>
	<li><p class="HalfSpaced">Since there are two copies of the same table, you must <b>alias</b> one of them. The example uses <i>Dupe</i> for the duplicate table, but any name will do.</p></li>
	<li><p class="HalfSpaced">If the main query displays the result, the subquery <b>must return a single value only</b>. You get this error if it returns multiple values:<br>
<font face="Courier New">&nbsp;&nbsp;&nbsp; At most one record can be returned by this subquery.</font></p></li>
	<li><p class="HalfSpaced">Even
though we asked for TOP 1, Access will return multiple records if there
is a tie, e.g. if there were two meter readings on the same date. <b>Include the primary key in the ORDER BY clause</b> to ensure it can decide which one to return if there are equal values.
	</p></li><li><p class="HalfSpaced">The main query will be <b>read-only</b>
(not editable.) That is always the case when the subquery shows a value
in the main query (i.e. when the subquery is in the SELECT clause of
the main query.)</p></li>
</ul>

<h2><a name="TopN"></a>TOP n records per group</h2>
<p>You want the three most recent orders for each client. Use a
subquery to select the 3 top orders per client, and use it to limit
which orders are selected in the main query:</p>
<div class="QuerySim">SELECT Orders.CustomerID, Orders.OrderDate, Orders.OrderID<br>
FROM Orders<br>
WHERE Orders.OrderID IN<br>
&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;(SELECT
TOP 3 OrderID
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;FROM
Orders AS Dupe
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;WHERE Dupe.CustomerID = Orders.CustomerID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;ORDER BY Dupe.OrderDate DESC, Dupe.OrderID DESC)&nbsp;</span><br>
ORDER BY Orders.CustomerID, Orders.OrderDate, Orders.OrderID;</div>
<h3>Points to note:</h3>
<ul>
	<li><p class="HalfSpaced">Since we have two copies of the same table, we need the alias.</p></li>
	<li><p class="HalfSpaced">Like
EXISTS in the first example above, there is no problem with the
subquery returning multiple records. The main query does not have to
show any value from the subquery.</p></li>
	<li><p class="HalfSpaced">Adding the primary key field to the ORDER BY clause differentiates between tied values.</p></li>
</ul>

<h2><a name="YTD"></a>Year to date</h2>
<p>A Totals query easily gives you a total for the current month, but
to get a year-to-date total or a total from the same month last year
means another calculation from the same table but for a different
period. A subquery is ideal for this purpose.</p>
<div class="QuerySim">SELECT Year([Orders].[OrderDate]) AS TheYear, <br>
	Month([Orders].[OrderDate]) AS TheMonth, <br>
	Sum([Order Details].[Quantity]*[Order Details].[UnitPrice]) AS MonthAmount, <br>
&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;(SELECT
Sum(OD.Quantity * OD.UnitPrice) AS
YTD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;FROM Orders AS A INNER JOIN [Order Details] AS OD ON A.OrderID = OD.OrderID &nbsp;&nbsp;</span><br>
&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;WHERE
A.OrderDate &gt;=
DateSerial(Year([Orders].[OrderDate]),1,1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;&nbsp;
AND A.OrderDate &lt; DateSerial(Year([Orders].[OrderDate]),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
	</span>&nbsp; <span style="background-color: rgb(255, 255, 255);">&nbsp;&nbsp;&nbsp;&nbsp;
Month([Orders].[OrderDate]) + 1,
1))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> AS YTDAmount <br>
	FROM Orders INNER JOIN [Order Details] ON Orders.OrderID = [Order Details].OrderID <br>
	GROUP BY Year([Orders].[OrderDate]), Month([Orders].[OrderDate]);</div>
<h3>Points to note:</h3>
<ul>
	<li><p class="HalfSpaced">The subquery uses the same tables, so aliases them as A (for <i>Orders</i>) and OD (for <i>Order Details</i>.)</p></li>
	<li><p class="HalfSpaced">The date criteria are designed so you can easily modify them for financial years rather than calendar years.</p></li>
	<li><p class="HalfSpaced">Even with several thousand records in <i>Order Details</i>, the query runs instantaneously.</p></li>
</ul>

<h2><a name="DeleteUnmatched"></a>Delete unmatched records</h2>
<p>The Unmatched Query Wizard (first dialog when you create a new
query) can help you identify records in one table that have no records
in another. But if you try to delete the unmatched records, Access may
respond with, <i>Could not delete from specified tables</i>.</p>
<p>An alternative approach is to use a subquery to identify the records
in the related table that have no match in the main table. This example
deletes any records in tblInvoice that have no matching record in the
tblInvoiceDetail table:</p>
<div class="QuerySim">DELETE FROM tblInvoice<br>
WHERE NOT EXISTS<br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
(SELECT
InvoiceID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
FROM
tblInvoiceDetail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);"> WHERE tblInvoiceDetail.InvoiceID = tblInvoice.InvoiceID); </span><br>
&nbsp;</div>

<h2><a name="DeDuplicate"></a>Delete duplicate records</h2>

<p>This example uses a subquery to de-duplicate a table. "Duplicate" is defined as records that have the same values in <i>Surname</i> and <i>FirstName</i>. We keep the one that has the lowest primary key value (field ID.)</p>
<div class="QuerySim">DELETE FROM Table1<br>WHERE ID &lt;&gt;&nbsp;<span style="background-color: rgb(255, 255, 255);"> (SELECT Min(ID) AS MinOfID FROM Table1 AS Dupe&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
WHERE (Dupe.Surname =
Table1.Surname)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
AND (Dupe.FirstName =
Table1.FirstName));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><br>
	<br>
</div>

<p>Nulls don't match each other, so if you want to treat pairs of Nulls as duplicates, use this approach:</p>
<div class="QuerySim">DELETE FROM Table1<br>WHERE ID &lt;&gt;&nbsp;<span style="background-color: rgb(255, 255, 255);"> (SELECT Min(ID) AS MinOfID FROM Table1 AS Dupe&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
WHERE ((Dupe.Surname =
Table1.Surname)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">&nbsp;&nbsp; OR (Dupe.Surname Is Null AND Table1.Surname Is Null))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">
AND ((Dupe.FirstName =
Table1.FirstName)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><br>
&nbsp;&nbsp;<span style="background-color: rgb(255, 255, 255);">&nbsp;&nbsp; OR (Dupe.FirstName Is Null AND Table1.FirstName Is Null)));&nbsp;</span><br>
</div>

<h2><a name="Aggregation"></a>Aggregation: Counts and totals</h2>
<p>Instead of creating a query into another query, you can summarize data with a subquery.</p>
<p>This example works with Northwind, to show how many distinct clients bought each product:</p>
<div class="QuerySim">
SELECT Products.ProductID, Products.ProductName, Count(Q.CustomerID) AS HowManyCustomers<br>
FROM<br>
<div style="background-color: white; margin-left: 20px; margin-right: 20px;">
&nbsp;(SELECT DISTINCT ProductID, CustomerID<br>
&nbsp;FROM Orders INNER JOIN [Order Details] ON Orders.OrderID = [Order Details].OrderID)  AS Q </div>
INNER JOIN Products ON Q.ProductID = Products.ProductID<br>
GROUP BY Products.ProductID, Products.ProductName;
</div>


<h3>Points to note:</h3>
<ul>
	<li>The subquery is in the FROM clause, where it easily replaces another saved query.</li>
	<li>The subquery in the FROM clause can return multiple fields.</li>
	<li>The entire subquery is aliased (as Q in this example), so the main query can refer to (and aggregate) its fields.</li>
	<li>Requires Access 2000 or later.</li>
</ul>
<h2><a name="Search"></a>Filters and searches</h2>
<p>Since subqueries can look up tables that are not in the main query, they are very useful for filtering forms and reports.</p>
<p>A Filter or WhereCondition is just a WHERE clause. A WHERE clause
can contain a subquery. So, you can use a subquery to filter a form or
report. You now have a way to filter a form or report on fields in
tables that are not even in the RecordSource!</p>
<p>In our first example <a href="#NotThere">above</a>, the main query
used only the Customers table, and the subquery filtered it to those
who had no orders in the last 90 days. You could filter the Customers
form in exactly the same way:</p>
<blockquote><pre><span class="CodeComment">'Create a subquery as a filter string.</span>
strWhere = "NOT EXISTS (SELECT Orders.OrderID FROM Orders " &amp; _
    "WHERE (Orders.CustomerID = Customers.CustomerID) AND (Orders.OrderDate &gt; Date() - 90))"
<span class="CodeComment">'Apply the string as the filter of the form that has only the Customers table.</span>
Forms!Customers.Filter = strWhere
Forms!Cusomters.FilterOn = True
<span class="CodeComment">'Or, use the string to filter a report that has only the Customers table.</span>
DoCmd.OpenReport "Customers", acViewPreview, , strWhere</pre></blockquote>
<p>This technique opens the door for writing incredibly powerful searches. Add subqueries to the basic techniques explained in the <a href="http://allenbrowne.com/ser-62.html">Search form</a> article, and you can offer a search where the user can select criteria based on any related table in the whole database.</p>
<p>The screenshot below is to whet your appetite for how you can use
subqueries. The form is unbound, with each tab collecting criteria that
will be applied against related tables. The final RESULTS tab offers to
launch several reports which don't even have those tables. It does this
by dynamically generating a huge WhereCondition string that consists of
several subqueries. The reports are filtered by the subqueries in the
string.</p>
<p align="center"><img src="subquery%20examples_files/SubquerySearch.png" alt="Subquery search screenshot" width="542" border="0" height="374"></p>
<h2><a name="Other"></a>Other examples</h2>
<p>These articles also illustrate the use of subqueries:</p>
<ul>
	<li><a href="http://allenbrowne.com/ser-58.html">Lookup a value in a range</a></li>
	<li><a href="http://allenbrowne.com/ranking.html">Ranking or numbering records</a></li>
	<li><a href="http://allenbrowne.com/ser-68.html">Extended DAvg()</a></li>
</ul>
<hr>
<h1>Conclusion</h1>
<p>Now you know how powerful subqueries are, you will also want to know their limitations. <a href="http://allenbrowne.com/subquery-02.html">Surviving subqueries</a> gives insight to help you trouble-shoot them.</p>
<hr>
<table style="text-align: center; width: 100%;">
<colgroup style="width: 33%;" span="3"></colgroup>
<tbody><tr>
<td><a href="http://allenbrowne.com/index.html">Home</a></td>
<td><a href="http://allenbrowne.com/tips.html">Index of tips</a></td>
<td><a href="#Top">Top</a></td>
</tr>
</tbody></table>
</body></html>